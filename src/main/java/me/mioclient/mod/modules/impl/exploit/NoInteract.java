package me.mioclient.mod.modules.impl.exploit;

import me.mioclient.api.events.impl.PacketEvent;
import me.mioclient.api.util.interact.BlockUtil;
import me.mioclient.mod.modules.Category;
import me.mioclient.mod.modules.Module;
import net.minecraft.block.Block;
import net.minecraft.init.Blocks;
import net.minecraft.item.*;
import net.minecraft.network.play.client.CPacketPlayerTryUseItemOnBlock;
import net.minecraft.util.math.BlockPos;
import net.minecraft.util.math.RayTraceResult;
import net.minecraftforge.event.entity.player.PlayerInteractEvent;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;

public class NoInteract extends Module {

    public NoInteract() {
        super("NoInteract", "Allows you to eat and throw exp when looking at tile entities.", Category.EXPLOIT, true);
    }

    @SubscribeEvent
    public void onPacketSend(PacketEvent.Send event) {

        RayTraceResult ray = mc.objectMouseOver;

        if (ray != null && ray.typeOfHit == RayTraceResult.Type.BLOCK && event.getPacket() instanceof CPacketPlayerTryUseItemOnBlock) {
            BlockPos pos = ray.getBlockPos();
            Block block = BlockUtil.getBlock(pos);

            if (block == Blocks.ANVIL || block == Blocks.ENDER_CHEST) {

                if (check()) {

                    event.setCanceled(true);
                }
            }
        }
    }

    @SubscribeEvent
    public void onInteract(PlayerInteractEvent.RightClickBlock event) {
        if (nullCheck()) {
            return;
        }

        Block block = BlockUtil.getBlock(event.getPos());

        if (block == Blocks.ANVIL || block == Blocks.ENDER_CHEST) {

            if (check()) {

                event.setCanceled(true);
            }
        }
    }

    private boolean check() {
        return (!mc.player.isSneaking()
                && mc.gameSettings.keyBindUseItem.isKeyDown()
                && (mc.player.getHeldItemMainhand().getItem() instanceof ItemExpBottle
                || mc.player.getHeldItemMainhand().getItem() instanceof ItemEnderPearl
                || mc.player.getHeldItemMainhand().getItem() instanceof ItemAppleGold
                || mc.player.getHeldItemMainhand().getItem() instanceof ItemBow
                || mc.player.getHeldItemMainhand().getItem() instanceof ItemChorusFruit));
    }
}
